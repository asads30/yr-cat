<template>
    <div class="item" v-if="product">
      <div class="item-top">
        <div :style="'background-image: url(' + background(product.thumbnail_buffer.data) + ');'" class="item-img"></div>
      </div>
      <div class="item-info">
        <div class="item-name">{{ product.name }}</div>
        <div class="item-des">{{ product.description }}</div>
        <button v-if="btnActive" class="item-add" type="button" @click="addToCart">{{ getPrice.toLocaleString }} â‚½</button>
        <div v-if="!btnActive" class="quantity">
          <button class="quantity-item quantity-item--minus" type="button" @click="reduceQuantity"></button>
          <div class="quantity-val">{{ quantity }}</div>
          <button class="quantity-item quantity-item--plus" type="button" @click="increaseQuantity"></button>
        </div>
      </div>
    </div>
  </template>
  
<script>
    import { api } from '@/services/api'
    export default {
        name: "AppCatalogProduct",
        data() {
            return {
                quantity: 0
            }
        },
        computed: {
            btnActive() {
                return this.$store.state.cart.find(product => product.id === this.product.id) ? this.product.isBtnActive : true;
            },
            getPrice(){
                return this.product.price/100
            }
        },
        methods: {
    addToCart() {
      this.$store.commit('addToCart', this.product);
      this.quantity++
    },
    reduceQuantity() {
      this.$store.commit('reduceQuantity', this.product.id);
      this.quantity--
    },
    increaseQuantity() {
      this.$store.commit('increaseQuantity', this.product.id);
      this.quantity++
    },
    fetchData(){
      let current = this.$store.state.cart.find(product => product.id === this.product.id)?.quantity || null
      this.quantity = current
    },
    background (buffer) {
      var binary = '';
      var bytes = new Uint8Array( buffer );
      var len = bytes.byteLength;
      for (var i = 0; i < len; i++) {
          binary += String.fromCharCode( bytes[ i ] );
      }
      return 'data:image/png;base64,' + window.btoa( binary )
    },
    async fetchProduct(){
        const id = this.$route.params.id

    }
  },
  mounted() {
    this.fetchData()
    this.fetchProduct()
  },
  watch: {
    $route: 'fetchData'
  }
  }
  </script>